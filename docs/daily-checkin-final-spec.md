# 데일리 체크인 최종 설계 명세서

> 작성일: 2025-12-02
> 상태: **확정 (Confirmed)**
> 다음 단계: 구현

---

## I. 설계 배경 및 목적

### 1.1 문제 정의

기존 "데일리 기록" 화면의 문제점:

| 문제 | 현상 | PRD 원칙 위반 |
|------|------|--------------|
| **부작용 기록 역설** | 부작용 없으면 기록 안 함 → 0% 달성 → "실패" 느낌 | 무조건적 긍정, 성취 강조 |
| **목표 설정 역설** | "주간 부작용 기록 목표"라는 개념 자체가 부자연스러움 | 부담을 줄이고 간단한 행동으로 인식 |
| **심리적 프레이밍 오류** | "부작용이 있어야 기록할 게 있다" | "실패" → "쉬어가는 날"로 재해석 |

### 1.2 핵심 모순

```
사용자 기대: "부작용 없이 건강하게 지낸 것" = 성공
앱의 해석: "기록 없음" = 미달성 = 실패
```

**PRD 언어 프레이밍 원칙 명백히 위반:**
- "아직 ~못함" → "이미 ~했음" 전환 불가능
- "실패" → "쉬어가는 날" 전환 불가능

---

## II. 기획 철학 (설계 의도)

### 2.1 GLP-1 치료에서 "매일 기록해야 할 것"은 무엇인가?

**핵심 인사이트**: 기록의 목적은 "문제를 추적"하는 것이 아니라 **"여정을 함께하는 것"**

| 항목 | 목적 | 기록 빈도 | 비고 |
|------|------|----------|------|
| **체중** | 변화 추적의 핵심 지표 | 매일 또는 정기적 | 가장 직접적인 피드백 |
| **컨디션** | 오늘의 몸 상태 확인 | 매일 | 좋든 나쁘든 기록 가능 |
| **식욕** | 약물 효과 확인 | 매일 | 변화 추세가 중요 |
| **증상 상세** | 특이사항 기록 | 필요시에만 | 컨디션이 나쁠 때만 |

### 2.2 "부작용 기록"의 진정한 목적

| 목적 | 기존 달성 여부 | 재설계 방향 |
|------|--------------|------------|
| **추적** | ✅ 달성 | 유지 |
| **안심** | ❌ 부분 달성 | "좋은 날"도 기록하여 전체 그림 제공 |
| **의료진 공유** | ✅ 달성 | "컨디션 히스토리"로 확장 |

**재정의**: "부작용 기록" → **"오늘의 컨디션 체크"**
- 증상이 있든 없든 매일 체크
- 증상 없음 = "좋음"으로 기록 = 성취

### 2.3 사용자가 매일 앱에 들어오게 만드는 본질적 동기

```
1. 체중 변화 확인 (가장 직접적인 피드백)
2. "오늘도 기록했다"는 작은 승리 (성취감)
3. "몸 상태가 정상이다" 확인 (안심감)
4. 치료 여정을 함께하는 느낌 (연결감)
```

**핵심**: 모든 동기를 충족하려면 **"기록하지 않은 날 = 실패"가 아닌 구조** 필요

### 2.4 용어 선택의 의도

| 용어 | 뉘앙스 | 채택 여부 | 이유 |
|------|--------|----------|------|
| 건강 체크 | "건강한지 아닌지 확인" → 이분법적 | ❌ | 실패/성공 느낌 유발 |
| 컨디션 체크 | "오늘의 상태는?" → 스펙트럼 | ✅ | 좋든 나쁘든 기록 가능 |
| 몸의 신호 체크 | PRD 용어와 일치, 정상화 | ✅ (보조) | 부작용을 신호로 재해석 |
| 데일리 체크인 | 습관 형성 강조 | ✅ (상위 개념) | 가볍고 친근한 느낌 |

### 2.5 개념 변환 매핑

| 기존 용어 | 변경 용어 | 이유 |
|----------|----------|------|
| 데일리 기록 | **데일리 체크인** | "기록"의 부담 → "체크인"의 가벼움 |
| 부작용 기록 (선택) | **일상 질문 + 자연스러운 파생** | 매일 기록 가능한 구조 |
| 증상 선택 | **몸의 신호 상세** | PRD 언어 프레이밍 |
| 부작용 기록 목표 | **체크인 목표** | 증상 여부와 무관하게 달성 가능 |

---

## III. 해결 방향 및 원칙

### 3.1 해결 방향

```
"부작용 기록" 중심 → "일상적 안부 질문" 중심으로 전환

- 매일 답변할 수 있는 일상적 질문
- 자연스러운 파생으로 부작용 정보 수집
- 매 답변마다 감정적 지지 피드백
- Red Flag는 숨겨진 로직으로 감지, 부드럽게 안내
```

### 3.2 핵심 원칙

| 원칙 | 구현 방식 |
|------|----------|
| **일상적 대화** | 의료 용어 대신 친근한 안부 질문 |
| **자연스러운 파생** | "힘들었어요" 선택 시에만 상세 질문 |
| **즉각적 피드백** | 매 답변마다 격려/안심 메시지 |
| **숨겨진 임상 감지** | Red Flag 조건을 자연스럽게 수집 |
| **두려움 최소화** | 안내도 "확인 권유" 톤으로 |

### 3.3 PRD 원칙 정합성

| PRD 핵심 가치 | 재설계 반영 |
|--------------|------------|
| 감정적 지지 | 컨디션 "좋아요"도 성취로 인정 |
| 안심감 | 증상 없는 날 = 좋은 날로 기록 |
| 성취감 | 매일 체크인 = 작은 승리 |
| 연결감 | 좋든 나쁘든 여정 기록 |

---

## IV. 확정된 기능 목록

### 4.1 핵심 기능

| # | 기능 | 설명 | 상태 |
|---|------|------|------|
| 1 | 일상적 질문 6개 | 식사, 수분, 속 편안함, 화장실, 에너지, 기분 | ✅ 확정 |
| 2 | 자연스러운 파생 | "힘들었어요" → 부작용 상세 질문으로 분기 | ✅ 확정 |
| 3 | 매 답변 피드백 | 기존 CopingGuide 활용 + 긍정 피드백 | ✅ 확정 |
| 4 | Red Flag 감지 | 췌장염, 담낭염, 탈수, 저혈당 등 | ✅ 확정 |
| 5 | 의료진 공유 형식 | 구조화된 주간 리포트 | ✅ 확정 |

### 4.2 감정적 UX 기능

| # | 기능 | 설명 | 상태 |
|---|------|------|------|
| 6 | 시간대별 인사 톤 | 아침/점심/저녁 다른 인사 | ✅ 확정 |
| 7 | 연속 체크인 축하 | 3일, 7일, 14일 등 마일스톤 | ✅ 확정 |
| 8 | 주사 다음날 컨텍스트 | 투여 다음날 맞춤 질문 | ✅ 확정 |
| 9 | 복귀 사용자 환영 | 3일+ 공백 후 따뜻한 메시지 | ✅ 확정 |
| 10 | 변화 감지 피드백 | "지난주보다 나아졌어요" 등 | ✅ 확정 |

---

## V. 질문 플로우 상세

### 5.1 전체 구조

```
┌─────────────────────────────────────────────────────────────┐
│                     데일리 체크인                            │
│                                                             │
│  🌤️ 컨텍스트 인사 (시간대/복귀/주사 다음날)                 │
│                                                             │
│  📊 체중 입력                                               │
│                                                             │
│  Q1. 🍽️ 식사 ──→ 메스꺼움/구토 파생                        │
│       ↓ 피드백                                              │
│  Q2. 💧 수분 ──→ 탈수 위험 파생                             │
│       ↓ 피드백                                              │
│  Q3. 😌 속 편안함 ──→ 복통/속쓰림 파생 → 췌장염/담낭염      │
│       ↓ 피드백                                              │
│  Q4. 🚽 화장실 ──→ 변비/설사 파생 → 장폐색                  │
│       ↓ 피드백                                              │
│  Q5. ⚡ 에너지 ──→ 피로/어지러움 파생 → 저혈당              │
│       ↓ 피드백                                              │
│  Q6. 😊 기분                                                │
│       ↓ 피드백                                              │
│                                                             │
│  ✅ 완료 + 종합 피드백 + (연속 기록 축하)                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 질문별 상세

#### Q1. 식사 질문
```
🍽️ 오늘 식사는 어떠셨어요?

[😋 잘 먹었어요] [😐 적당히 먹었어요] [😣 좀 힘들었어요]
```

| 답변 | 피드백 | 파생 |
|------|--------|------|
| 잘 먹었어요 | "좋아요! 규칙적인 식사가 치료에 도움이 돼요 💚" | 없음 |
| 적당히 먹었어요 | "괜찮아요, 소량씩 드시는 것도 좋아요" | 없음 |
| 좀 힘들었어요 | "어떤 점이 힘드셨어요?" | Q1-1로 |

**Q1-1 파생**: 속이 메스꺼웠어요 / 입맛이 없었어요 / 조금만 먹어도 배불러요

#### Q2. 수분 질문
```
💧 물은 충분히 드셨나요?

[💧 충분히 마셨어요] [💧 좀 적게 마신 것 같아요] [😰 거의 못 마셨어요]
```

| 답변 | 피드백 | 파생 |
|------|--------|------|
| 충분히 마셨어요 | "잘하셨어요! 수분 섭취가 정말 중요해요 💧" | 없음 |
| 좀 적게 마신 것 같아요 | "내일은 조금 더 챙겨보세요" | 없음 |
| 거의 못 마셨어요 | "물 마시기가 힘드셨나요?" | Q2-1로 |

#### Q3. 속 편안함 질문
```
😌 속은 편하셨어요?

[😊 네, 괜찮았어요] [😐 좀 불편했어요] [😣 많이 불편했어요]
```

| 답변 | 피드백 | 파생 |
|------|--------|------|
| 네, 괜찮았어요 | "다행이에요! 💚" | 없음 |
| 좀/많이 불편했어요 | "어떤 불편함이 있으셨어요?" | Q3-1로 |

**Q3-1 파생**: 속이 쓰렸어요 / 배가 아팠어요 / 배가 빵빵했어요
**Q3-2 (배 아픔 시)**: 복통 위치 선택 → 심각도 → 등 방사 여부 (췌장염/담낭염 체크)

#### Q4. 화장실 질문
```
🚽 화장실은 잘 다녀오셨어요?

[😊 네, 잘 봤어요] [😐 좀 불규칙했어요] [😣 힘들었어요]
```

| 답변 | 피드백 | 파생 |
|------|--------|------|
| 네, 잘 봤어요 | "좋아요! 규칙적인 게 중요해요" | 없음 |
| 불규칙/힘들었어요 | "어떤 상황이었어요?" | Q4-1로 |

**Q4-1 파생**: 변비가 있었어요 / 설사를 했어요

#### Q5. 에너지 질문
```
⚡ 오늘 에너지는 어떠셨어요?

[😊 활기 있었어요] [😐 평소와 비슷했어요] [😴 많이 피곤했어요]
```

| 답변 | 피드백 | 파생 |
|------|--------|------|
| 활기 있었어요 | "좋은 하루였네요! ⚡" | 없음 |
| 평소와 비슷했어요 | "꾸준히 유지하고 계시네요" | 없음 |
| 많이 피곤했어요 | "다른 증상도 함께 있었나요?" | Q5-1로 |

**Q5-1 파생**: 어지러웠어요 / 식은땀이 났어요 / 붓기가 있었어요 (저혈당/신부전 체크)

#### Q6. 기분 질문
```
😊 마지막으로, 오늘 기분은 어떠셨어요?

[😊 좋았어요] [😐 그저 그랬어요] [😔 좀 우울했어요]
```

| 답변 | 피드백 |
|------|--------|
| 좋았어요 | "좋은 하루였네요! 😊" |
| 그저 그랬어요 | "그런 날도 있죠. 내일은 더 좋을 거예요" |
| 좀 우울했어요 | "힘든 날도 있어요. 당신은 잘하고 있어요 💚" |

---

## VI. 컨텍스트 인사 시스템

### 6.1 시간대별 인사

| 시간대 | 인사 예시 |
|--------|----------|
| 아침 (5-11시) | "좋은 아침이에요 ☀️" |
| 점심 (11-17시) | "오늘 하루 어떠세요?" |
| 저녁 (17-21시) | "오늘 하루 수고하셨어요 🌙" |
| 밤 (21-5시) | "늦은 시간까지 수고 많으셨어요" |

### 6.2 주사 다음날 컨텍스트

```dart
if (isAfterInjectionDay) {
  greeting = "어제 주사 맞으셨죠? 오늘 컨디션은 어떠세요?";
  // 부작용 질문에 더 세심한 주의
}
```

### 6.3 복귀 사용자 환영

```dart
if (daysSinceLastCheckin >= 3) {
  greeting = """
    다시 만나서 반가워요 😊
    쉬어가는 것도 여정의 일부예요.
    오늘부터 다시 함께해요!
  """;
}
```

---

## VII. 연속 체크인 축하 시스템

### 7.1 마일스톤 정의

| 연속 일수 | 축하 메시지 | 시각적 효과 |
|----------|------------|------------|
| 3일 | "벌써 3일째 함께하고 있어요!" | 작은 별 이모지 |
| 7일 | "일주일 완주! 대단해요 🎉" | 축하 애니메이션 |
| 14일 | "2주 동안 꾸준히 기록하셨네요!" | 뱃지 부여 |
| 21일 | "3주! 이제 습관이 되셨을 거예요" | 뱃지 부여 |
| 30일 | "한 달 완주! 정말 대단해요 🏆" | 특별 뱃지 |

### 7.2 구현 로직

```dart
int consecutiveDays = calculateConsecutiveDays(userId);

if (consecutiveDays in [3, 7, 14, 21, 30, 60, 90]) {
  showMilestoneAnimation();
  showCelebrationMessage(consecutiveDays);
}
```

---

## VIII. 변화 감지 피드백

### 8.1 감지 항목

| 항목 | 감지 조건 | 피드백 예시 |
|------|----------|------------|
| 메스꺼움 감소 | 이번 주 빈도 < 지난주 | "지난주보다 메스꺼움이 줄었어요! 몸이 적응하고 있네요 💚" |
| 식욕 안정화 | 식욕 점수 평균 상승 | "식욕 조절이 잘 되고 있어요" |
| 에너지 회복 | 에너지 "좋음" 비율 증가 | "에너지가 돌아오고 있네요! ⚡" |
| 체중 변화 | 목표 방향으로 변화 | "꾸준히 변화하고 있어요" |

### 8.2 구현 로직

```dart
WeeklyComparison comparison = compareWithLastWeek(userId);

if (comparison.nauseaDecreased) {
  feedbacks.add("지난주보다 메스꺼움이 줄었어요! 몸이 적응하고 있네요 💚");
}

if (comparison.appetiteImproved) {
  feedbacks.add("식욕 조절이 잘 되고 있어요. 약이 잘 작용하는 신호예요");
}
```

---

## IX. 피드백 시스템 상세

### 9.1 피드백 구조

```dart
class CheckinFeedback {
  final String message;           // 메인 메시지
  final String? stat;             // 통계 (선택)
  final String? action;           // 즉각 행동 제안 (선택)
  final FeedbackTone tone;        // positive, supportive, cautious
}

enum FeedbackTone {
  positive,    // 💚 긍정 (잘한 경우)
  supportive,  // 💛 지지 (힘든 경우)
  cautious,    // 🧡 주의 (Red Flag 감지)
}
```

### 9.2 기존 CopingGuide 활용

부작용 관련 답변 시 기존 데이터 활용:

```dart
// 메스꺼움 선택 시
CopingGuide guide = copingGuideRepository.getGuide('메스꺼움');

showFeedback(
  message: guide.reassuranceMessage,  // "몸이 약에 적응하는 자연스러운 반응이에요"
  stat: guide.reassuranceStat,        // "85%가 2주 내 개선을 경험해요"
  action: guide.immediateAction,      // "시원한 물 한 모금 마시기"
);
```

### 9.3 긍정 답변용 피드백 (신규)

| 질문 | 긍정 답변 | 피드백 |
|------|----------|--------|
| 식사 | 잘 먹었어요 | "좋아요! 규칙적인 식사가 치료에 도움이 돼요 💚" |
| 수분 | 충분히 마셨어요 | "잘하셨어요! 수분 섭취가 정말 중요해요 💧" |
| 속 편안함 | 괜찮았어요 | "다행이에요! 💚" |
| 화장실 | 잘 봤어요 | "좋아요! 규칙적인 게 중요해요" |
| 에너지 | 활기 있었어요 | "좋은 하루였네요! ⚡" |
| 기분 | 좋았어요 | "좋은 하루였네요! 😊" |

---

## X. Red Flag 감지 시스템

### 10.1 감지 매트릭스

| Red Flag | 트리거 경로 | 감지 조건 |
|----------|------------|----------|
| 급성 췌장염 | Q3 → 배 아픔 → 상복부 | 심한 통증 + 등 방사 + 수시간 지속 |
| 담낭염 | Q3 → 배 아픔 → 우상복부 | 심한 통증 + 발열/오한 |
| 심한 탈수 | Q1 → 구토 + Q2 → 못 마심 | 구토 3회+ AND 물 못 마심 |
| 장폐색 | Q4 → 변비 | 5일+ 변비 + 심한 빵빵함 + 가스 없음 |
| 저혈당 | Q5 → 어지러움 + 식은땀 | 증상 + 당뇨약 병용 |
| 신부전 | Q5 → 피로 + 붓기 | 심한 피로 + 부종 + 소변 감소 |

### 10.2 안내 톤 (확정)

```
💛 오늘 기록해주신 증상이 조금 확인이 필요해 보여요.

[구체적 증상 요약]

이런 경우 드물지만 확인이 필요할 때가 있어요.
오늘 중으로 가까운 병원에 들러서
한 번 확인받아 보시는 게 안심이 될 것 같아요.

💡 응급실이 아니어도 괜찮아요.
   가까운 내과에서 확인받으시면 돼요.

[병원 찾기] [나중에 확인할게요]
```

---

## XI. 의료진 공유 형식

### 11.1 주간 리포트 구조

```
╔══════════════════════════════════════════════════════════════╗
║                   GLP-1 치료 주간 리포트                      ║
║  환자: OOO | 약제: 위고비 0.5mg | 기간: 11.25-12.01         ║
╠══════════════════════════════════════════════════════════════╣
║  ▶ 주요 지표                                                ║
║    체중: 85.2 → 84.5kg (▼0.7kg)                            ║
║    식욕: 평균 3.2/5, 안정적                                 ║
║    체크인: 5/7일 (71%)                                      ║
╠══════════════════════════════════════════════════════════════╣
║  ▶ 증상 발생 현황                                           ║
║    메스꺼움 3일 (경미2, 중등도1)                            ║
║    변비 2일 (경미)                                          ║
╠══════════════════════════════════════════════════════════════╣
║  ▶ 주의 필요 기록                                           ║
║    11/28: 상복부 통증, 중등도, 4시간                        ║
║    → 등 방사 없음, 다음날 소실, Red Flag 해당 없음          ║
╠══════════════════════════════════════════════════════════════╣
║  ▶ 컨디션 추이                                              ║
║    😊😔😐😊😐😊--                                            ║
║    월 화 수 목 금 토 일                                      ║
╚══════════════════════════════════════════════════════════════╝
```

---

## XII. 데이터 모델

### 12.1 DB 스키마 변경

```sql
-- weight_logs 확장
ALTER TABLE weight_logs ADD COLUMN condition_data jsonb;

-- condition_data 구조 예시
{
  "meal": "good",           -- good/moderate/difficult
  "hydration": "good",      -- good/moderate/poor
  "gi_comfort": "good",     -- good/uncomfortable/very_uncomfortable
  "bowel": "normal",        -- normal/irregular/difficult
  "energy": "good",         -- good/normal/tired
  "mood": "good",           -- good/neutral/low
  "symptoms": [             -- 파생된 증상 상세
    {
      "type": "nausea",
      "severity": "mild",
      "details": {...}
    }
  ],
  "context": {
    "is_post_injection": false,
    "days_since_last_checkin": 1,
    "consecutive_days": 5
  }
}
```

---

## XIII. 구현 우선순위

### Phase 1: 핵심 플로우 (P0)
- [ ] 질문 6개 UI 구현
- [ ] 파생 질문 로직
- [ ] 기본 피드백 시스템
- [ ] 데이터 저장

### Phase 2: 감정적 UX (P1)
- [ ] 시간대별 인사
- [ ] 연속 체크인 축하
- [ ] 복귀 사용자 환영
- [ ] 변화 감지 피드백

### Phase 3: 안전 시스템 (P1)
- [ ] Red Flag 감지 로직
- [ ] 안내 메시지 UI
- [ ] 주사 다음날 컨텍스트

### Phase 4: 의료진 공유 (P2)
- [ ] 주간 리포트 생성
- [ ] 공유 모드 UI

---

## XIV. 관련 문서

| 문서 | 경로 | 설명 |
|------|------|------|
| 초기 재설계안 | `docs/daily-checkin-redesign.md` | 철학적 배경 |
| 임상 기반 명세 | `docs/clinical-daily-checkin-spec.md` | 임상 지표 상세 |
| 질문 트리 상세 | `docs/daily-checkin-question-tree.md` | 분기 로직 상세 |
| PRD | `docs/prd.md` | 감정적 UX 원칙 |
| 기존 CopingGuide | `lib/features/coping_guide/` | 부작용 안심 메시지 |

---

## XV. 다음 세션 가이드

### 이 문서의 목적
GLP-1 앱의 "데일리 체크인" 기능을 근본적으로 재설계한 최종 명세서입니다.
기존의 "부작용 기록" 중심에서 "일상적 안부 질문" 중심으로 전환하여,
사용자가 매일 부담 없이 체크인하면서 자연스럽게 임상 데이터를 수집하고,
감정적 지지를 받을 수 있도록 설계되었습니다.

### 확정된 핵심 기능
1. **일상적 질문 6개**: 식사, 수분, 속 편안함, 화장실, 에너지, 기분
2. **자연스러운 파생**: "힘들었어요" 선택 시에만 부작용 상세 질문
3. **매 답변 피드백**: 긍정/지지 메시지 + 기존 CopingGuide 활용
4. **컨텍스트 인사**: 시간대별, 주사 다음날, 복귀 사용자
5. **연속 체크인 축하**: 3일, 7일, 14일 등 마일스톤
6. **변화 감지 피드백**: "지난주보다 나아졌어요" 등
7. **Red Flag 감지**: 췌장염, 담낭염, 탈수 등 숨겨진 감지 + 부드러운 안내
8. **의료진 공유**: 구조화된 주간 리포트

### 다음 단계
1. Phase 1 구현 시작 (핵심 질문 플로우)
2. UI 프로토타입 검토
3. 기존 코드 리팩토링 계획 수립
