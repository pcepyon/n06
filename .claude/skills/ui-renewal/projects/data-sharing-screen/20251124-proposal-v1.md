# DataSharingScreen UI 개선 제안서
## Phase 2A: 분석 & 방향 설정

**작성일**: 2025-11-24
**상태**: 완성됨
**Design System**: Gabium v1.0

---

## 1. 현재 상태 분석

### 1.1 기존 화면 개요
- **경로**: `lib/features/data_sharing/presentation/screens/data_sharing_screen.dart`
- **기능**: 건강 기록을 의료진과 공유하는 화면
- **주요 구성요소**:
  - 기간 선택 (ChoiceChip)
  - 투여 기록 (카드 리스트)
  - 투여 순응도 (진행률)
  - 주사 부위 이력 (텍스트 리스트)
  - 체중 변화 (리스트)
  - 부작용 기록 (카드 리스트)
  - 공유 종료 버튼

### 1.2 식별된 문제

#### 문제 카테고리 1: 브랜드 색상 시스템 부재
**현황**:
- AppBar: Material 기본 스타일 사용
- 종료 버튼: 하드코딩된 `Colors.orange`
- 에러 상태: `Colors.red` 직접 사용
- 로딩 상태: Material 기본 `CircularProgressIndicator`

**영향**:
- Gabium 브랜드 정체성 약화
- 색상 일관성 부족
- 의료 앱의 신뢰감 저하

**Gabium 토큰 미사용**:
- Primary: `#4ADE80` ❌
- Error: `#EF4444` ❌
- Warning: `#F59E0B` ❌

#### 문제 카테고리 2: 시각적 계층 및 타이포그래피 부족
**현황**:
- 섹션 제목: 동일한 16px, bold 사용
- 기록 항목: 제목/부제 구분 미흡
- 에러 메시지: 아이콘 + 텍스트 조합 불명확
- 기간 선택 라벨: 일반 텍스트 (구분 안됨)

**영향**:
- 정보 가독성 저하
- 사용자가 중요도 구분 어려움
- 의료 데이터의 신뢰감 감소

**Gabium 토큰 미사용**:
- Type Scale: lg (20px/18px), base (16px), sm (14px) 계층 부족
- Font Weight: Semibold (600) 미사용

#### 문제 카테고리 3: 컴포넌트 일관성 및 상태 표시 부족
**현황**:
- 기간 선택: ChoiceChip (Material 기본)
- 종료 확인: AlertDialog (Material 기본)
- 에러 상태: 중앙 정렬, 단순 구조
- 로딩 상태: 원형 스피너만 표시
- 빈 상태: 아이콘 + 텍스트만 표시

**영향**:
- Gabium 디자인 시스템과 불일치
- 사용자 피드백이 약함
- 접근성 개선 기회 상실

---

## 2. Gabium 설계 원칙과의 정렬

### 2.1 적용할 브랜드 가치

| 가치 | 적용 방안 |
|------|---------|
| **안전성** | Error 상태에 명확한 아이콘 + 색상, 종료 확인 다이얼로그 강화 |
| **친근함** | 둥근 모서리 (8px 이상), 부드러운 색상 팔레트, 온따뜻한 Warning |
| **동기부여** | 성공 메시지 반복 (토스트), 진행 상황 시각화 (진행률 강조) |
| **효율성** | 명확한 타이포그래피 계층, 데이터 구조화 |

### 2.2 Design System 토큰 연결

**색상**:
- AppBar 배경: `#F8FAFC` (Neutral-50)
- AppBar 제목: `#1E293B` (Neutral-800, lg/xl Bold)
- 종료 버튼: `#F59E0B` (Warning/Secondary - 주의 필요)
- 에러: `#EF4444` (Error)
- 성공: `#10B981` (Success)

**타이포그래피**:
- AppBar 제목: xl (20px, Bold)
- 섹션 제목: lg (18px, Semibold)
- 기록 항목 제목: base (16px, Regular)
- 기록 항목 보조: sm (14px, Regular)

**여백 (Spacing)**:
- 카드 패딩: md (16px)
- 섹션 간: lg (24px)
- 페이지 좌우: md (16px)

**모양**:
- 카드: md (12px) border-radius
- 모달: lg (16px) border-radius
- 버튼: sm (8px) border-radius

---

## 3. 개선 방향 (7가지 변경사항)

### Change 1: AppBar 브랜드 적용
**기존**:
```dart
AppBar(
  title: const Text('기록 보여주기'),
  leading: IconButton(...),
  automaticallyImplyLeading: false,
)
```

**개선점**:
- 배경색: Neutral-50 (`#F8FAFC`)
- 제목: xl (20px, Bold), Neutral-800 (`#1E293B`)
- 닫기 버튼: 44x44px 터치 영역, Primary 색상 호버
- Shadow: sm (미세한 깊이감)
- 경계선: Neutral-200 (1px)

**Gabium 토큰**:
- Background: Neutral-50
- Title: xl/Bold/Neutral-800
- Icon: 24x24px, Neutral-600
- Height: 56px

### Change 2: 기간 선택 컴포넌트 개선
**기존**:
```dart
Row(
  children: DateRange.values.map<Widget>((period) {
    return Expanded(
      child: Padding(
        padding: const EdgeInsets.symmetric(horizontal: 4),
        child: ChoiceChip(label: Text(period.label), ...)
      ),
    );
  }).toList(),
)
```

**개선점**:
- 컨테이너: 카드 패턴 (배경 Neutral-50, 테두리 Neutral-200)
- 라벨: sm (14px, Semibold), Neutral-700
- 칩 스타일: Primary (선택) / Tertiary (미선택)
- 간격: 8px (sm)
- Padding: md (16px)

**Gabium 토큰**:
- Container: Card pattern (md border-radius, sm shadow)
- Label: sm/Semibold/Neutral-700
- Spacing: sm (칩 간)

### Change 3: 섹션 제목 타이포그래피 강화
**기존**:
```dart
Text(title, style: const TextStyle(fontWeight: FontWeight.bold, fontSize: 16))
```

**개선점**:
- 크기: lg (18px, Semibold)
- 색상: Neutral-800 (`#1E293B`)
- 상단 여백: lg (24px) (첫 섹션 제외)
- 하단 여백: md (16px)

**Gabium 토큰**:
- Typography: lg/Semibold/Neutral-800

### Change 4: 카드 구조 및 리스트 아이템 개선
**기존**:
```dart
Card(
  child: ListTile(
    leading: const Icon(Icons.medical_services),
    title: Text('${record.actualDoseMg} mg'),
    subtitle: Text('...'),
  ),
)
```

**개선점**:
- Card 패턴: md (12px), sm shadow, Neutral-200 border
- ListTile → 커스텀 구조:
  - Leading: 아이콘 + 배경 (Primary 컬러)
  - Title: base (16px, Medium), Neutral-800
  - Subtitle: sm (14px, Regular), Neutral-600
  - Trailing: 타입별 배지 (Optional)
- Hover: Shadow md, translateY(-2px)
- Min Height: 64px

**Gabium 토큰**:
- Card: md border-radius, sm/md shadow
- Border: Neutral-200
- Typography: base/Medium, sm/Regular
- Spacing: md (패딩)

### Change 5: 에러 상태 강화
**기존**:
```dart
Icon(Icons.error_outline, size: 48, color: Colors.red),
Text('오류가 발생했습니다: $error'),
ElevatedButton(...)
```

**개선점**:
- 컨테이너: EmptyStateWidget 패턴 적용
- 아이콘: lg (32px), Error 색상
- 제목: lg (18px, Semibold), Neutral-800
- 설명: base (16px, Regular), Neutral-600
- 버튼: Primary variant, md 크기
- 배경: Neutral-50
- 수직 간격: lg (24px)

**Gabium 토큰**:
- Icon: Error/lg
- Typography: lg/Semibold, base/Regular
- Button: Primary/medium
- Spacing: lg

### Change 6: 공유 종료 버튼 개선
**기존**:
```dart
ElevatedButton.icon(
  ...
  style: ElevatedButton.styleFrom(
    backgroundColor: Colors.orange,
    ...
  ),
)
```

**개선점**:
- GabiumButton 재사용: `variant: GabiumButtonVariant.secondary`
- 색상: Primary 테두리/텍스트 (종료지만 위험하지 않음)
- 크기: medium (44px)
- 아이콘: 좌측 배치
- 텍스트: Semibold (600)

**Gabium 토큰**:
- Button: Secondary/medium/Gabium
- Icon: 24x24px
- Color: Primary

### Change 7: 로딩 및 빈 상태 시각화 강화
**기존 로딩**:
```dart
state.isLoading
  ? const Center(child: CircularProgressIndicator())
  : ...
```

**개선점**:
- 스피너: Primary 색상 명시
- 크기: 48px (lg)
- 배경: Neutral-50
- 중앙 정렬

**기존 빈 상태**:
```dart
Icon(Icons.inbox_outlined, size: 48, color: Colors.grey),
Text('선택된 기간에 기록이 없습니다.'),
```

**개선점**:
- EmptyStateWidget 패턴 적용
- 아이콘: lg (32px), Neutral-400
- 제목: lg (18px, Semibold), Neutral-700
- 설명: base (16px), Neutral-600
- 수직 중앙 정렬
- Padding: xl (32px)

**Gabium 토큰**:
- Icon: Neutral-400/lg
- Typography: lg/Semibold, base/Regular
- Spacing: xl

---

## 4. 컴포넌트 재사용 및 생성 계획

### 재사용할 기존 컴포넌트
1. **GabiumButton** (Primary, Secondary, Danger 변형)
   - 공유 종료 버튼
   - 에러 재시도 버튼

2. **GabiumTextField** (Optional - 추후)
   - 기간 커스텀 선택 (미포함)

3. **EmptyStateWidget**
   - 빈 상태 화면 (부재 시 생성)
   - 에러 상태 화면

### 생성할 신규 컴포넌트
1. **DataSharingPeriodSelector**
   - 기간 선택 칩 그룹
   - 카드 패턴 컨테이너
   - 디자인 시스템 통합

2. **ExitConfirmationDialog**
   - 공유 종료 확인 다이얼로그
   - Gabium Modal 패턴
   - Primary + Secondary 버튼

### 패턴 적용
- Card Pattern: md border-radius, sm shadow
- Empty State Pattern: 아이콘 + 제목 + 설명 + 버튼
- Modal Pattern: lg border-radius, xl shadow, 중앙 정렬

---

## 5. 접근성 개선

| 항목 | 기준 | 계획 |
|------|------|------|
| 색상 대비 | WCAG AA (4.5:1) | Neutral-800 텍스트 on Neutral-50 배경 (17.5:1) |
| 터치 영역 | 44x44px | 모든 버튼, 아이콘 44x44px 이상 |
| 포커스 표시 | 2px outline | GabiumButton에 포함됨 |
| 텍스트 크기 | 최소 16px | base 이상만 사용 |
| 아이콘 | 명확한 의미 | 모든 아이콘에 레이블 추가 |

---

## 6. 기술 스택

- **Framework**: Flutter 3.x
- **State Management**: Riverpod
- **Design System**: Gabium v1.0
- **Icon Library**: Material Icons

---

## 7. 영향 범위

| 항목 | 현황 |
|------|------|
| 파일 수정 | 1개 (`data_sharing_screen.dart`) |
| 신규 컴포넌트 | 2개 |
| 기존 컴포넌트 재사용 | 1-2개 |
| 아키텍처 변경 | 없음 (Presentation Layer만) |
| 비즈니스 로직 변경 | 없음 |

---

## 8. 예상 효과

### 사용자 경험 (UX)
- ✅ 더 명확한 정보 계층 (타이포그래피)
- ✅ 일관된 브랜드 색상 (신뢰감)
- ✅ 개선된 에러 상태 피드백
- ✅ 더 명확한 확인 메커니즘 (다이얼로그)

### 개발 (DX)
- ✅ Gabium 컴포넌트 재사용 (일관성)
- ✅ Design System 토큰 활용 (유지보수성)
- ✅ 향후 다크모드 전환 용이

### 의료 앱 특성
- ✅ 신뢰감 강화 (색상 시스템)
- ✅ 정보 가독성 개선 (타이포그래피)
- ✅ 중요 액션의 명확한 확인 (종료 다이얼로그)

---

## 9. 다음 단계

### Phase 2B: 구현 명세
- 28개 이상의 Design System 토큰 정의
- 각 컴포넌트별 상세 명세
- Flutter 구현 예제
- 접근성 체크리스트

### Phase 2C: 자동 구현
- 신규 컴포넌트 2개 생성
- DataSharingScreen 전체 개선
- 모든 Design System 토큰 적용

### Phase 3: 최종 검증
- Component Registry 업데이트
- Flutter analyze 통과 확인
- 통합 테스트

---

**Status**: ✅ 완성됨
**다음 문서**: 20251124-implementation-v1.md (Phase 2B)
