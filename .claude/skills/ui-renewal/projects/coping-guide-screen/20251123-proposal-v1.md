# Coping Guide Screen Improvement Proposal

## Overview

The Coping Guide Screen displays side effect management guides in a list format. Currently, it uses Material Design defaults without alignment to the Gabium Design System. This proposal outlines the UI improvements to align with brand values (Safety, Approachability, Motivation) while enhancing visual hierarchy, spacing, and interactive feedback.

---

## Current State Issues

### Brand Consistency Issues
- **Colors:** Uses Material default Colors (red.shade100, red.shade900) instead of Gabium semantic colors (Error #EF4444, Error-50 #FEF2F2)
- **Typography:** No explicit design system mapping - relies on Theme.of(context).textTheme defaults without semantic hierarchy
- **Spacing:** Inconsistent use of hardcoded EdgeInsets.all(16) without scaling system reference
- **Visual Style:** Warning banner lacks subtle shadow and rounded corners consistent with design system
- **Button Styling:** ElevatedButton uses Material defaults instead of Gabium Primary/Secondary button variants

### Visual Quality Issues
- **Severity Warning Banner:** Hard-edged container with flat red background lacks sophistication and visual depth
- **Card Structure:** Generic Material Card without semantic styling, no clear visual hierarchy between sections
- **Feedback Section:** Button states unclear, no loading or success feedback animation
- **List Items:** No divider or spacing consistency between guide cards
- **Accessibility:** Warning icons lack proper sizing and spacing alignment with text

### UX Issues
- **Purpose Not Clear:** Users don't immediately understand if this is informational or actionable content
- **Feedback Ambiguous:** "도움이 되었나요?" feedback flow lacks visual confirmation or next-step guidance
- **Navigation:** No clear visual distinction between cards and actions within cards
- **State Management:** Feedback state changes lack visual feedback (transitions, confirmations)
- **Mobile Optimization:** Large touch targets (buttons) not consistently 44x44px as per accessibility guidelines

---

## Improvement Direction

### Change 1: Align Severity Warning Banner to Design System

**Current:**
- Hard-coded `Colors.red.shade100` background
- Uses Material Icon with red color
- Flat design without elevation
- Inconsistent with validation alert patterns

**Proposed:**
- Replace with ValidationAlert component (already in registry for onboarding)
- Use Error semantic color system
- Add proper shadow and rounded corners
- Ensure consistent appearance across app

**Rationale:**
- ValidationAlert component already exists and is battle-tested from onboarding phase
- Semantic color system ensures consistency and improves maintenance
- Enhanced visual polish improves trust (key brand value: Safety First)
- Reduces code duplication

**Design System Mapping:**
- Component: ValidationAlert (Section 7 - Core Components, Feedback Components)
- Type: error variant
- Background: Error-50 (#FEF2F2)
- Border Left: Error (#EF4444), 4px
- Text Color: Dark Error (#991B1B)
- Icon Size: 24px
- Padding: md (16px)
- Border Radius: sm (8px)
- Shadow: sm (0 2px 4px rgba(15, 23, 42, 0.06))

---

### Change 2: Replace ElevatedButtons with Gabium Design System Buttons

**Current:**
- Uses Material ElevatedButton throughout (detail view, feedback, symptom check)
- Default styling without variant system
- No loading states or semantic color variants
- Feedback buttons lack clear success state

**Proposed:**
- Main CTAs (Detail view, Symptom check): GabiumButton - Primary variant, Medium size
- Feedback Yes/No buttons: GabiumButton - Secondary variant, Small size
- Add loading state to symptom check button
- Add success state visual after feedback submission

**Rationale:**
- GabiumButton component already exists with full variant system
- Primary for main actions (higher visual weight)
- Secondary for optional/alternative actions
- Consistent interaction patterns across app
- Primary color (#4ADE80) conveys safety and motivation (brand values)

**Design System Mapping:**
- Component: GabiumButton (Section 7 - Core Components, Buttons - Primary & Secondary variants)
- Main CTA Button (Detail/Symptom Check):
  - Variant: Primary
  - Size: Medium
  - Height: 44px
  - Background: Primary (#4ADE80)
  - Text: White (#FFFFFF), Semibold (600)
  - Padding: 24px horizontal
  - Border Radius: sm (8px)
  - Shadow: sm (0 2px 4px rgba(15, 23, 42, 0.06))
  - Hover: #22C55E background
  - Active: #16A34A background
- Feedback Buttons (Yes/No):
  - Variant: Secondary
  - Size: Small
  - Height: 36px
  - Background: Transparent
  - Border: 2px solid Primary (#4ADE80)
  - Text: Primary (#4ADE80), Semibold (600)
  - Hover: 8% Primary background

---

### Change 3: Upgrade Card Structure with Design System Styling

**Current:**
- Generic Material Card with basic margin/padding
- No clear visual hierarchy for content sections
- Flat appearance without semantic styling
- Missing divider between guide items

**Proposed:**
- Use Design System Card Container styling
- Add top border accent using Primary color for visual interest
- Implement clear spacing scale (md/lg) between internal sections
- Add subtle shadow for depth (sm level)
- Include rounded corners (md: 12px) for approachability

**Rationale:**
- Clear visual structure improves scannability
- Color accent on top conveys positive emotion (green = health, motivation)
- Consistent card styling across app
- Better visual separation between multiple guides in list
- Rounded corners reinforce "friendly" brand positioning

**Design System Mapping:**
- Component: Card Container (Section 6 - Layout Patterns)
- Background: White (#FFFFFF)
- Border: 1px solid Neutral-200 (#E2E8F0) + 3px top accent Primary (#4ADE80)
- Border Radius: md (12px)
- Padding: md (16px)
- Shadow: sm (0 2px 4px rgba(15, 23, 42, 0.06))
- Spacing between cards: md (16px)
- Internal section spacing: md (16px)

---

### Change 4: Implement Feedback Widget with Clear State Feedback

**Current:**
- Simple text feedback with local state tracking
- No visual confirmation or next steps
- Feedback submission lacks loading/success state
- Text message unclear ("더 자세한 가이드 보기" doesn't make sense as feedback response)

**Proposed:**
- Add success animation after feedback submission
- Use semantic color (Success #10B981) for positive feedback confirmation
- Show clear confirmation message ("피드백을 주셔서 감사합니다!")
- Add optional "다시 평가하기" (re-rate) option
- Integrate with GabiumToast for submission feedback

**Rationale:**
- Visual confirmation creates sense of completion (motivation brand value)
- Success color provides immediate psychological feedback
- Clear messaging improves UX clarity
- Re-rate option provides flexibility for users
- Toast notifications are consistent with existing pattern (used in auth)

**Design System Mapping:**
- Success State Color: Success (#10B981)
- Success Background: Success-50 (#ECFDF5)
- Confirmation Message Text: Success (#10B981), size base (16px), weight 600
- Toast Variant: Success
- Toast Background: Success-50 (#ECFDF5)
- Toast Border Left: Success (#10B981), 4px
- Toast Text: Dark Success (#065F46)
- Animation Duration: 200ms ease
- Icon Size: 24px (checkmark)

---

### Change 5: Add Dividers and Improve List Visual Separation

**Current:**
- No dividers between card items
- Inconsistent spacing relies on Card margins
- Difficult to distinguish individual guide items in dense lists

**Proposed:**
- Add visual divider between guide cards (minimal - 1px Neutral-200)
- Ensure consistent spacing (md: 16px) between all list items
- Improve visual scanning with clear card boundaries
- Optional: Add divider within card between title/content and buttons

**Rationale:**
- Clear visual separation improves scannability (efficiency brand value)
- Consistent spacing prevents visual confusion
- Minimal dividers maintain "friendly" aesthetic
- Accessibility: Better visual structure aids users with visual processing differences

**Design System Mapping:**
- List Item Divider: 1px solid Neutral-200 (#E2E8F0)
- List Item Spacing: md (16px)
- Section Divider (internal): 1px solid Neutral-200 (#E2E8F0), 16px spacing above/below
- Container Padding: 16px (mobile), following Design System

---

### Change 6: Enhance Typography Hierarchy with Explicit Design System Mapping

**Current:**
- Relies on Theme.of(context).textTheme without explicit design system alignment
- Symptom name displayed as "titleLarge" (unclear semantic meaning)
- Inconsistent heading levels
- No explicit color mapping for text hierarchy

**Proposed:**
- Guide Title: Typography scale "xl" (20px, Semibold 600) - Card-level heading
- Symptom Name: Typography scale "lg" (18px, Semibold 600) with Primary accent optional
- Guide Description: Typography scale "base" (16px, Regular 400) - body text
- Section Titles (detailed guide): Typography scale "lg" (18px, Semibold 600)
- Button Labels: Typography scale "base" (16px, Semibold 600)
- Feedback Label: Typography scale "base" (16px, Regular 400)

**Rationale:**
- Explicit design system mapping ensures consistency
- Clear hierarchy improves information scanning
- Semantic color on symptom name (optional Primary accent) conveys actionability
- Consistent with Gabium Design System typography scale
- Improves readability for users 20-50 years old (primary audience)

**Design System Mapping:**
- Typography System Reference (Section 4):
  - xl: 20px, Semibold (600), line-height 28px
  - lg: 18px, Semibold (600), line-height 26px
  - base: 16px, Regular (400), line-height 24px
  - sm: 14px, Regular (400), line-height 20px
- Color Hierarchy:
  - Titles: Neutral-800 (#1E293B)
  - Body: Neutral-600 (#475569)
  - Secondary: Neutral-500 (#64748B)
  - Symptom name optional accent: Primary (#4ADE80)

---

### Change 7: Improve AppBar Styling and Consistency

**Current:**
- Default Material AppBar without design system styling
- No visual connection to Gabium Design System
- Missing icon/branding consistency

**Proposed:**
- Apply Design System AppBar styling from Section 6
- Use Primary (#4ADE80) accent (bottom border or subtle background tint)
- Ensure 56px height per design system
- Add back button with proper 44x44px touch target

**Rationale:**
- Consistent header styling across all screens
- Primary color accent reinforces brand
- Proper touch target sizing aids accessibility
- Visual continuity improves app cohesion

**Design System Mapping:**
- Component: Header (App Bar) (Section 6 - Layout Patterns)
- Height: 56px
- Background: White (#FFFFFF)
- Border Bottom: 1px solid Neutral-200 (#E2E8F0)
- Optional Bottom Accent: 3px solid Primary (#4ADE80)
- Title: xl size (20px), Bold (700), Neutral-800 (#1E293B)
- Title Font: Pretendard Variable
- Back Button: 44x44px touch area
- Padding: 0 16px

---

## Design System Token Reference

Complete mapping of all tokens used in this proposal:

| Element | Token Path | Value | Usage |
|---------|-----------|-------|-------|
| Primary Color | Colors - Primary | #4ADE80 | CTA buttons, accents, top border |
| Primary Hover | Colors - Primary Hover | #22C55E | Button hover state |
| Primary Active | Colors - Primary Active | #16A34A | Button active/pressed state |
| Error Color | Colors - Semantic - Error | #EF4444 | Warning banner border |
| Error Background | Colors - Semantic - Error-50 | #FEF2F2 | Warning banner background |
| Error Text Dark | Colors - Error Dark | #991B1B | Warning banner text |
| Success Color | Colors - Semantic - Success | #10B981 | Feedback confirmation |
| Success Background | Colors - Semantic - Success-50 | #ECFDF5 | Success toast background |
| Success Text Dark | Colors - Success Dark | #065F46 | Success message text |
| White | Colors - Neutral - White | #FFFFFF | Card/Button backgrounds |
| Neutral-50 | Colors - Neutral - 50 | #F8FAFC | Light backgrounds |
| Neutral-200 | Colors - Neutral - 200 | #E2E8F0 | Dividers, borders |
| Neutral-500 | Colors - Neutral - 500 | #64748B | Secondary text |
| Neutral-600 | Colors - Neutral - 600 | #475569 | Body text |
| Neutral-700 | Colors - Neutral - 700 | #334155 | Labels |
| Neutral-800 | Colors - Neutral - 800 | #1E293B | Headings |
| Typography - xl | Typography - xl | 20px Semibold | Card titles |
| Typography - lg | Typography - lg | 18px Semibold | Section titles |
| Typography - base | Typography - base | 16px Regular | Body text |
| Typography - sm | Typography - sm | 14px Regular | Labels, secondary text |
| Spacing - xs | Spacing - xs | 4px | Text-icon spacing |
| Spacing - sm | Spacing - sm | 8px | Component internal spacing |
| Spacing - md | Spacing - md | 16px | Default element spacing |
| Spacing - lg | Spacing - lg | 24px | Section spacing |
| Spacing - xl | Spacing - xl | 32px | Major section gaps |
| Border Radius - sm | Border Radius - sm | 8px | Buttons, inputs, containers |
| Border Radius - md | Border Radius - md | 12px | Cards, modals |
| Border Width - Thin | Border Widths - Thin | 1px | Dividers, borders |
| Border Width - Medium | Border Widths - Medium | 2px | Button borders |
| Border Width - Thick | Border Widths - Thick | 4px | Accent borders |
| Shadow - sm | Shadow Levels - sm | 0 2px 4px rgba(15, 23, 42, 0.06) | Cards, buttons |
| Shadow - md | Shadow Levels - md | 0 4px 8px rgba(15, 23, 42, 0.08) | Interactive elements |
| Button Height - Medium | Component Heights - Button Medium | 44px | Standard buttons |
| Button Height - Small | Component Heights - Button Small | 36px | Secondary/feedback buttons |
| Input/Control Height | Component Heights - Input Field | 48px | Form elements |
| App Bar Height | Component Heights - App Bar | 56px | Header |
| Icon Size - base | Icon Sizes - base | 24px | Standard icons |
| Touch Target Min | Touch Targets | 44x44px | All interactive elements |

---

## Preserved Elements

The following elements should remain unchanged as they work well:

1. **Screen Purpose & Content Type**: The screen's core function (displaying guides, allowing detail view, accepting feedback) remains appropriate and should not change.

2. **Navigation Pattern**: Using Navigator.push for detail view navigation is acceptable and requires no redesign.

3. **Data Binding Pattern**: The use of ConsumerStatefulWidget and Riverpod for state management is correct and should continue.

4. **Content Structure**: The sequence of warning banner → title → description → buttons → feedback is logical and should remain.

5. **Loading State Handling**: The "when" pattern for AsyncValue state handling is appropriate and doesn't need visual redesign.

---

## Dependencies

### Prerequisites (must do first):
- ✅ Gabium Design System v1.0 completed
- ✅ GabiumButton component available (registry verified)
- ✅ ValidationAlert component available (registry verified)
- ✅ GabiumToast component available (registry verified)
- ✅ No blocking dependencies - all required components already exist

### Impact (will need updating after):
- **Home Dashboard Screen**: May need to verify bottom navigation consistency (GabiumBottomNavigation already uses design system)
- **Symptom Tracking Screen**: If it displays guides, should apply same styling
- **Detailed Guide Screen**: Should apply same card and typography styling to internal sections
- **Other Guide Lists**: Any other screens displaying coping guides should follow this pattern
- **Style Variables**: If creating Flutter theme file, these tokens should be extracted there

---

## Component Reuse

### Existing Components to Reuse:

1. **ValidationAlert**
   - Used For: Severity warning banner
   - Source: `lib/features/onboarding/presentation/widgets/validation_alert.dart`
   - How: Replace custom SeverityWarningBanner with ValidationAlert(type: error)
   - Props: type (error), message (string), icon (optional IconData)

2. **GabiumButton**
   - Used For: Detail view CTA, symptom check button, feedback yes/no buttons
   - Source: `lib/features/authentication/presentation/widgets/gabium_button.dart`
   - How: Replace all ElevatedButton instances
   - Main CTAs: GabiumButton(variant: primary, size: medium)
   - Feedback: GabiumButton(variant: secondary, size: small)

3. **GabiumToast**
   - Used For: Feedback submission confirmation
   - Source: `lib/features/authentication/presentation/widgets/gabium_toast.dart`
   - How: Show success toast after feedback submission
   - Props: context, message, variant (success)

4. **GabiumBottomNavigation** (already used)
   - Current: Already implemented in main app navigation
   - No change needed

### New Components to Create:

1. **CopingGuideFeedbackResult** (optional)
   - Type: Feedback confirmation widget
   - Purpose: Show success state after feedback submission
   - Props: feedbackType (bool), onRetry (VoidCallback)
   - Design: Uses Success color system, animated checkmark icon
   - Will be added to Registry in Phase 2B

---

## Success Criteria

1. **Visual Hierarchy**: Title, subtitle, description, and buttons clearly distinguish in size/weight
2. **Color System**: All colors match Gabium Design System (no custom colors like Colors.red.shade100)
3. **Spacing Consistency**: All spacing uses design system scale (no arbitrary pixel values)
4. **Component Reuse**: GabiumButton, ValidationAlert, GabiumToast fully replace Material equivalents
5. **Accessibility**: All touch targets minimum 44x44px, color contrast WCAG AA
6. **Feedback Flow**: Feedback submission shows clear success confirmation
7. **Visual Depth**: Cards have appropriate shadow (sm) and border radius (md)
8. **Typography Alignment**: All text explicitly maps to design system typography scale
9. **AppBar Consistency**: Header styled per design system with Primary accent
10. **Mobile Optimization**: No hardcoded pixel values that break on different screen sizes

---

## Technical Context

### Platform/Framework:
- **Framework**: Flutter 3.x
- **State Management**: Riverpod (Consumer/ConsumerStatefulWidget)
- **Navigation**: Material Navigator (Navigator.push/pop)
- **Theme**: Will use Gabium Design System values

### Special Constraints:
- Must preserve Riverpod state management pattern
- Must maintain navigation stack integrity
- Must support async loading state during feedback submission
- Must preserve existing entity/DTO models (CopingGuide, GuideSection)
- Feedback notifier integration must remain unchanged
- The app serves medical GLP-1 context - visual consistency and clarity are critical for trust

### Build Compatibility:
- ✅ Targets iOS 12.0+, Android 5.0+
- ✅ All design system components are Flutter-compatible
- ✅ No additional dependencies required
- ✅ Can incrementally adopt design tokens via Flutter ThemeExtension

---

## Layout Structure (High-Level)

### CopingGuideScreen Layout:

```
┌─────────────────────────────────────────────────┐
│ AppBar (56px)                                   │
│ Title: "부작용 대처 가이드" (xl, Bold)          │
│ Background: White, Border-bottom: Neutral-200  │
├─────────────────────────────────────────────────┤
│ ListView.builder (scrollable)                   │
│                                                 │
│ ┌────────────────────────────────────────────┐ │
│ │ Card 1 (guide item)                        │ │
│ │ Padding: md (16px)                         │ │
│ │ Border-radius: md (12px)                   │ │
│ │ Border-top: 3px Primary (#4ADE80)          │ │
│ │ Shadow: sm                                 │ │
│ │                                            │ │
│ │ ┌─[Conditional] Severity Warning ───────┐ │ │
│ │ │ ValidationAlert(type: error)           │ │ │
│ │ │ Icon + Message + Button (CTA)          │ │ │
│ │ │ Color: Error theme                     │ │ │
│ │ └────────────────────────────────────────┘ │ │
│ │                                            │ │
│ │ Title: "{Symptom} 대처 가이드" (lg)        │ │
│ │ Color: Neutral-800 (#1E293B)              │ │
│ │ Margin-bottom: md (16px)                  │ │
│ │                                            │ │
│ │ Description: [shortGuide text] (base)     │ │
│ │ Color: Neutral-600 (#475569)              │ │
│ │ Margin-bottom: md (16px)                  │ │
│ │                                            │ │
│ │ ┌─ Divider ────────────────────────────┐  │ │
│ │ │ 1px solid Neutral-200                │  │ │
│ │ │ Margin: md (16px) top/bottom         │  │ │
│ │ └────────────────────────────────────────┘ │ │
│ │                                            │ │
│ │ Button: "더 자세한 가이드 보기" (CTA)       │ │
│ │ - GabiumButton(variant: primary)           │ │
│ │ - Height: 44px (medium)                    │ │
│ │ - Full width                               │ │
│ │ - Color: Primary (#4ADE80)                 │ │
│ │ - Margin-bottom: md (16px)                 │ │
│ │                                            │ │
│ │ ┌─ Feedback Section (if applicable) ────┐ │ │
│ │ │ Question: "도움이 되었나요?" (base)    │ │ │
│ │ │ Buttons: Yes/No                       │ │ │
│ │ │ - GabiumButton(variant: secondary)    │ │ │
│ │ │ - Height: 36px (small)                │ │ │
│ │ │ - Spacing between: md (16px)          │ │ │
│ │ │ - After selection: success state      │ │ │
│ │ │   with checkmark + message            │ │ │
│ │ └────────────────────────────────────────┘ │ │
│ └────────────────────────────────────────────┘ │
│                                                 │
│ [Card divider: 1px Neutral-200, margin md]     │
│                                                 │
│ ┌────────────────────────────────────────────┐ │
│ │ Card 2 (next guide item)                   │ │
│ │ [Same structure as Card 1]                 │ │
│ └────────────────────────────────────────────┘ │
│                                                 │
│ [... more cards ...]                           │
│                                                 │
├─────────────────────────────────────────────────┤
│ GabiumBottomNavigation (56px + safe area)     │
│ Active Tab: Coping Guide (#4ADE80)            │
└─────────────────────────────────────────────────┘
```

### DetailedGuideScreen Layout:

```
┌─────────────────────────────────────────────────┐
│ AppBar (56px)                                   │
│ Title: "{Symptom} 대처 가이드" (xl, Bold)      │
│ Back Button (44x44px)                          │
├─────────────────────────────────────────────────┤
│ SingleChildScrollView (scrollable)              │
│ Padding: md (16px)                             │
│                                                 │
│ Symptom Name: "{Symptom}" (xl, Bold)           │
│ Color: Neutral-800 (#1E293B)                   │
│ Margin-bottom: lg (24px)                       │
│                                                 │
│ ┌─ Section 1 ─────────────────────────────────┐
│ │ Title: "[Section Title]" (lg, Semibold)    │ │
│ │ Color: Neutral-800 (#1E293B)               │ │
│ │ Margin-bottom: sm (8px)                    │ │
│ │                                            │ │
│ │ Content: "[Section Content]" (base)        │ │
│ │ Color: Neutral-600 (#475569)               │ │
│ │ Line-height: 24px (design system)          │ │
│ └────────────────────────────────────────────┘
│ Spacing after section: lg (24px)               │
│                                                 │
│ ┌─ Section 2 ─────────────────────────────────┐
│ │ [Same as Section 1]                        │ │
│ └────────────────────────────────────────────┘
│ [... more sections ...]                        │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## Approval Required

- [ ] User approves improvement direction
- [ ] All Design System tokens available
- [ ] Dependencies acknowledged
- [ ] Component reuse strategy confirmed
- [ ] Ready to proceed to Phase 2B (Implementation Specs)

---

**Document Status**: Ready for User Review
**Last Updated**: 2025-11-23
**Version**: 1.0
**Framework**: Flutter
**Design System**: Gabium v1.0
