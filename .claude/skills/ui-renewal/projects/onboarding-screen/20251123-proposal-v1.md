# Onboarding Screen Improvement Proposal

## Overview

The onboarding flow (4-step wizard) currently uses generic Material Design components without brand alignment. This proposal defines improvements to align with Gabium Design System while maintaining clear information hierarchy and smooth user flow through profile setup, weight goals, dosage planning, and confirmation.

## Current State Issues

### Brand Consistency Issues
- **Color Palette Mismatch**: Generic Material colors (blue, red, orange) used instead of Gabium semantic colors (Primary #4ADE80, Success #10B981, Warning #F59E0B, Error #EF4444)
- **Button Styling Inconsistent**: Standard ElevatedButton without Gabium variants (Primary, Secondary, Tertiary)
- **Typography Not Aligned**: Default TextStyle without Gabium typography scale (3xl, 2xl, xl, lg, base, sm, xs)
- **Input Fields**: Generic OutlineInputBorder without Gabium GabiumTextField component styling
- **Spacing Inconsistent**: Manual padding values (24, 32, 16, 8) without systematic spacing scale adherence
- **No Brand Visual Language**: Missing rounded corners consistency (Gabium sm: 8px), shadows, and visual hierarchy markers

### Visual Quality Issues
- **Hierarchy Clarity**: Section titles lack visual distinction from body text (same weight treatment as content)
- **Whitespace**: Inconsistent spacing between sections; some gaps too large (32px), others too small
- **Error/Warning Messages**: Custom container styling with mismatched colors; inconsistent visual treatment
- **Card/Summary Sections**: No shadow or visual elevation to distinguish from background
- **Progress Indicator**: LinearProgressIndicator (4px) lacks visual prominence; text-based step indicator redundant
- **Form Layout**: Input fields lack consistent label positioning and helper text treatment
- **Touch Targets**: Input field height 48px appropriate, but button height undefined (Material default)
- **Alignment**: Left-aligned text for titles; inconsistent alignment in data display sections

### UX Issues
- **Purpose Clarity**: No welcoming hero section; step jumps directly to form
- **Interaction Feedback**: No clear visual feedback for focus states, disabled states
- **Validation Messages**: Error messages appear inline but not consistently; warning about unsafe weight loss goal competes with info message
- **Data Presentation**: Summary screen shows raw data without visual grouping or emphasis
- **Accessibility**: No explicit focus states, missing semantic spacing for screen readers
- **Progressive Disclosure**: All validation results shown simultaneously; could be more progressive
- **Button Labels**: Generic "다음" (Next) and "확인" (Confirm) without context of what data is being saved

## Improvement Direction

### Change 1: Implement Gabium Typography Scale
- **Current**: Mixed TextStyle definitions with inline font sizes (24px, 16px, 14px)
- **Proposed**: All text uses Gabium Typography scale (3xl for hero, xl for section titles, base for body, sm for labels)
- **Rationale**: Establishes clear visual hierarchy and brand consistency across onboarding
- **Design System Mapping**:
  - Component: Typography
  - Step Headers (Section titles): `xl` (20px, Semibold)
  - Welcome Text (Hero step 1): `2xl` (24px, Bold)
  - Body Text (Input labels): `base` (16px, Regular)
  - Helper Text: `sm` (14px, Regular)
  - Step Indicator: `sm` (14px, Regular), Neutral-500
  - Typography: Pretendard Variable (primary), system font fallback

### Change 2: Redesign Form Inputs Using GabiumTextField Component
- **Current**: Generic TextField + OutlineInputBorder with inconsistent styling
- **Proposed**: Replace all text inputs with GabiumTextField component for consistent styling
- **Rationale**: Ensures consistent focus states, error states, and visual feedback; aligns with design system
- **Design System Mapping**:
  - Component: Form - GabiumTextField
  - Height: 48px
  - Border Radius: sm (8px)
  - Default Border: 2px solid Neutral-300 (#CBD5E1)
  - Focus Border: 2px solid Primary (#4ADE80)
  - Focus Background: Primary 10% (#4ADE80 at 10% opacity)
  - Error Border: 2px solid Error (#EF4444)
  - Label Font: sm (14px, Semibold), Neutral-700
  - Placeholder Color: Neutral-400 (#94A3B8)
  - Helper Text: xs (12px, Regular), Neutral-500

### Change 3: Replace ElevatedButton with GabiumButton Component
- **Current**: Standard ElevatedButton with Material default styling
- **Proposed**: Use GabiumButton (Primary variant, Medium size) for all CTA buttons; Secondary variant for back button
- **Rationale**: Unified button styling aligned with design system; consistent states and feedback
- **Design System Mapping**:
  - Component: Button - GabiumButton
  - Primary Button (Next/Save):
    - Variant: Primary
    - Size: Medium (44px height)
    - Background: Primary (#4ADE80)
    - Text: White (#FFFFFF), Semibold (600)
    - Hover: #22C55E
    - Active: #16A34A
    - Disabled: #4ADE80 at 40% opacity
    - Width: Full width (container)
  - Secondary Button (Back - app bar):
    - Variant: Secondary / Ghost
    - Size: Medium (44x44px icon button)
    - Text: Primary (#4ADE80), outline
    - Padding: 12px 16px

### Change 4: Semantic Color System for Validation Feedback
- **Current**: Ad-hoc colors (Colors.red.shade50, Colors.blue.shade50, Colors.orange.shade50)
- **Proposed**: Use Gabium semantic colors with consistent styling
- **Rationale**: Clear semantic meaning; consistent with design system; better accessibility
- **Design System Mapping**:
  - Error Messages: Error (#EF4444) left border, #FEF2F2 background, error text
  - Warning Messages: Warning (#F59E0B) left border, #FFFBEB background, warning text
  - Info Messages: Info (#3B82F6) left border, #EFF6FF background, info text
  - Success Messages: Success (#10B981) left border, #ECFDF5 background, success text
  - Component: Feedback - Alert Banner (4px left border, sm padding)
  - Border Radius: sm (8px)

### Change 5: Implement Spacing Scale Consistency
- **Current**: Mixed spacing values (24, 32, 16, 8 px) without systematic adherence
- **Proposed**: Apply Gabium spacing scale (xs: 4px, sm: 8px, md: 16px, lg: 24px, xl: 32px, 2xl: 48px)
- **Rationale**: Visual consistency and rhythm; easier maintenance
- **Design System Mapping**:
  - Page padding: xl (32px) horizontal, lg (24px) vertical
  - Section spacing: lg (24px) between major sections
  - Input field spacing: md (16px) between fields
  - Button spacing: md (16px) above button from last field
  - Header spacing: md (16px) below section title
  - Progress indicator spacing: sm (8px)

### Change 6: Hero/Welcome Section for Step 1
- **Current**: Direct form input without context
- **Proposed**: Add AuthHeroSection-like welcome component (title, subtitle, optional icon)
- **Rationale**: Sets context, welcomes user, improves emotional connection (Motivation brand value)
- **Design System Mapping**:
  - Component: AuthHeroSection (reusable component)
  - Title: 2xl (24px, Bold), Neutral-800
  - Subtitle: base (16px, Regular), Neutral-600
  - Spacing: lg (24px) below title, lg (24px) below subtitle
  - Background: Neutral-50 (#F8FAFC)
  - Usage: Step 1 (profile setup) context

### Change 7: Add Visual Grouping to Summary Section
- **Current**: Flat list of data pairs without visual grouping
- **Proposed**: Section-based cards with visual elevation and proper spacing
- **Rationale**: Improves data scanning; visual separation of information categories
- **Design System Mapping**:
  - Component: Card Container
  - Background: White (#FFFFFF)
  - Border: 1px solid Neutral-200 (#E2E8F0) OR shadow
  - Border Radius: md (12px)
  - Shadow: sm (0 2px 4px rgba(15, 23, 42, 0.06))
  - Padding: md (16px)
  - Spacing: lg (24px) between cards
  - Hover Effect: Shadow md, 2px lift (optional, may not apply to summary)

### Change 8: Progress Indicator Enhancement
- **Current**: LinearProgressIndicator (4px height) + text "X/4단계"
- **Proposed**: Keep LinearProgressIndicator but enhance styling; consider clearer step labels
- **Rationale**: Current design works but could be more visually prominent
- **Design System Mapping**:
  - Component: Progress Bar
  - Height: 8px (increased from 4px for visibility)
  - Background: Neutral-200 (#E2E8F0)
  - Fill: Primary (#4ADE80), animated transition
  - Border Radius: full (999px)
  - Step Indicator: sm (14px, Regular), Neutral-500, updated dynamically
  - Spacing: md (16px) below progress bar

### Change 9: Focus/Error State Visual Feedback
- **Current**: Error messages shown but no visual focus indication
- **Proposed**: Clear focus states on inputs; immediate error indication with semantic color
- **Rationale**: Improves accessibility; clearer feedback to users
- **Design System Mapping**:
  - Focus State: 2px border Primary (#4ADE80), outline none
  - Error State: 2px border Error (#EF4444), error message below input (4px spacing)
  - Disabled State: Background Neutral-100 (#F1F5F9), text Neutral-400, 0.6 opacity
  - Keyboard Focus: 2px solid Primary outline, 2px offset

### Change 10: Consistent Date Picker Integration
- **Current**: showDatePicker with default Material styling
- **Proposed**: Maintain showDatePicker but document styling guidelines for consistency
- **Rationale**: Date picker is system component; ensure visual consistency where possible
- **Design System Mapping**:
  - Component: Form - Date Input (via showDatePicker)
  - Note: Material DatePicker is system component; ensure input field wrapper uses GabiumTextField styling
  - Input label and helper text follow GabiumTextField conventions

## Design System Token Reference

| Element | Token Path | Value | Usage |
|---------|-----------|-------|-------|
| Page Padding | Spacing - xl | 32px | Horizontal container padding |
| Section Spacing | Spacing - lg | 24px | Between major sections |
| Field Spacing | Spacing - md | 16px | Between form fields |
| Step Title | Typography - xl | 20px, Semibold | Section headers |
| Welcome Title | Typography - 2xl | 24px, Bold | Hero section (Step 1) |
| Body Text | Typography - base | 16px, Regular | Input labels, body content |
| Helper Text | Typography - sm | 14px, Regular | Label text, helper text |
| Caption | Typography - xs | 12px, Regular | Error messages, small text |
| Input Height | Sizing - Medium | 48px | All form inputs |
| Input Border Radius | Border Radius - sm | 8px | Input fields, buttons |
| Button Height | Sizing - Medium | 44px | CTA buttons |
| Button Color | Colors - Primary | #4ADE80 | Button background, links |
| Error Color | Colors - Error | #EF4444 | Error messages, invalid state |
| Warning Color | Colors - Warning | #F59E0B | Warning messages |
| Success Color | Colors - Success | #10B981 | Success messages |
| Info Color | Colors - Info | #3B82F6 | Info messages |
| Input Background | Colors - Neutral | #FFFFFF | Input field background |
| Input Border | Colors - Neutral - 300 | #CBD5E1 | Default input border |
| Focus Background | Colors - Primary at 10% | #4ADE80 (10%) | Input focus background |
| Error Background | Colors - Error at 5% | #FEF2F2 | Error message background |
| Warning Background | Colors - Warning at 5% | #FFFBEB | Warning message background |
| Success Background | Colors - Success at 5% | #ECFDF5 | Success message background |
| Info Background | Colors - Info at 5% | #EFF6FF | Info message background |
| Card Background | Colors - White | #FFFFFF | Summary cards |
| Card Border | Colors - Neutral - 200 | #E2E8F0 | Card borders |
| Card Shadow | Shadow - sm | 0 2px 4px rgba(15,23,42,0.06) | Card elevation |
| Progress Fill | Colors - Primary | #4ADE80 | Progress bar fill |
| Progress Background | Colors - Neutral - 200 | #E2E8F0 | Progress bar background |
| Neutral Text | Colors - Neutral - 500 | #64748B | Secondary text, placeholder |
| Label Text | Colors - Neutral - 700 | #334155 | Input labels |
| Font Family | Typography - Primary | Pretendard Variable | All text |

## Preserved Elements

- **Stepper Navigation Logic**: PageView-based navigation with swipe physics disabled works well; keep controller pattern
- **Data Validation**: Weight range checking (20-300kg), comparison logic (target < current), weekly goal calculation are correct
- **Step Sequence**: 4-step flow (Profile → Weight → Dosage → Summary) is logical and user-friendly
- **App Bar Back Button**: Conditional back button (disabled on step 1) is good UX
- **Medication Template Integration**: Using existing MedicationTemplate entity and dropdown is efficient
- **ConsumerWidget Pattern**: Summary screen's use of Riverpod ConsumerWidget for state management is appropriate

## Dependencies

### Prerequisites (must do first)
- ✅ GabiumTextField component must be created/available (already in registry)
- ✅ GabiumButton component must be created/available (already in registry)
- ✅ AuthHeroSection component should be available for reuse (already in registry for auth, can be adapted)
- ✅ Gabium Design System colors and typography system must be finalized (v1.0 complete)

### Impact (will need updating after)
- Home Dashboard: May reuse progress bar styling from onboarding
- Other onboarding-adjacent screens: Settings, Profile editing may adopt similar form styling
- Entire app: Alert banner component styling affects consistent error/warning presentation across features

## Component Reuse

### Existing Components to Reuse
- **GabiumButton**: Primary variant for CTA buttons ("다음", "확인")
- **GabiumTextField**: For all text input fields (name, weight, period)
- **AuthHeroSection**: Can be adapted/reused for welcome section (Step 1 context)
- **GabiumToast**: For final success/error notification after save (optional enhancement)

### New Components to Create
- **OnboardingProgressBar**: Enhanced progress indicator with step labels (optional, may use existing ProgressBar)
- **ValidationAlert**: Semantic alert banner for error/warning/info messages (can use existing Alert component pattern or create as reusable widget)
- **SummaryCard**: Data grouping card for summary section (can use Card + design system styling)

## Success Criteria

1. All form inputs use GabiumTextField component with correct focus/error states
2. All buttons use GabiumButton with Primary variant and correct sizing
3. Text follows Gabium typography scale (no mixed font sizes)
4. Spacing follows Gabium scale (no arbitrary pixel values)
5. Error/warning/info messages use semantic colors with consistent styling
6. Summary section uses card-based layout with proper visual grouping
7. Hero section added to Step 1 for context and brand alignment
8. All components have appropriate focus/keyboard navigation states
9. Validation feedback is clear and semantic (error vs warning vs info)
10. Step progress indicator is visually prominent and follows design system

## Technical Context

### Platform/Framework
- Flutter
- Riverpod (state management)
- GoRouter (navigation)

### Special Constraints
- Summary screen uses ConsumerWidget + onboardingNotifierProvider for state management
- Must maintain existing validation logic (weight range, weekly goal calculation)
- Must preserve PageController navigation pattern
- Date picker uses Material showDatePicker (system component)
- Dropdown inputs use standard DropdownButtonFormField

## Layout Structure (High-Level)

### Overall Onboarding Flow
```
+----------------------------------+
| App Bar with title, back button  | (conditional back)
+----------------------------------+
| LinearProgressIndicator (8px)    | Primary #4ADE80
| Step indicator "X/4단계" (sm)    |
+----------------------------------+
|                                  |
| PageView[4 steps]                |
|                                  |
| Step 1: Profile (Hero + Input)   |
| ┌──────────────────────────────┐ |
| │ [Hero Section]               │ |
| │ Title: "이름을 입력해주세요"    │ |
| │ Subtitle: (optional context)  │ |
| │                               │ |
| │ [GabiumTextField]             │ |
| │ Label: "성명"                  │ |
| │ Hint: "성명"                   │ |
| │                               │ |
| │ [GabiumButton Primary]        │ |
| │ "다음"                         │ |
| └──────────────────────────────┘ |
|                                  |
| Step 2: Weight & Goal            |
| ┌──────────────────────────────┐ |
| │ Title: "체중 및 목표 설정"      │ |
| │                               │ |
| │ [GabiumTextField]             │ |
| │ "현재 체중 (kg)"               │ |
| │                               │ |
| │ [GabiumTextField]             │ |
| │ "목표 체중 (kg)"               │ |
| │                               │ |
| │ [GabiumTextField]             │ |
| │ "목표 기간 (주)"               │ |
| │                               │ |
| │ [ValidationAlert - Error]     │ |
| │ if validation fails           │ |
| │                               │ |
| │ [ValidationAlert - Info]      │ |
| │ "주간 목표: X.XXkg/주"        │ |
| │                               │ |
| │ [ValidationAlert - Warning]   │ |
| │ if weekly goal > 1kg          │ |
| │                               │ |
| │ [GabiumButton Primary]        │ |
| │ "다음"                         │ |
| └──────────────────────────────┘ |
|                                  |
| Step 3: Dosage Plan             |
| ┌──────────────────────────────┐ |
| │ Title: "투여 계획 설정"         │ |
| │                               │ |
| │ [DropdownButtonFormField]     │ |
| │ "약물명" + options            │ |
| │                               │ |
| │ [ListTile / DateInput]        │ |
| │ "시작일" + date picker        │ |
| │                               │ |
| │ [Disabled TextField]          │ |
| │ "투여 주기 (일)" (read-only)   │ |
| │                               │ |
| │ [DropdownButtonFormField]     │ |
| │ "초기 용량 (mg)" + options    │ |
| │                               │ |
| │ [ValidationAlert - Error]     │ |
| │ if validation fails           │ |
| │                               │ |
| │ [GabiumButton Primary]        │ |
| │ "다음"                         │ |
| └──────────────────────────────┘ |
|                                  |
| Step 4: Summary & Confirmation  |
| ┌──────────────────────────────┐ |
| │ Title: "정보 확인"              │ |
| │                               │ |
| │ [SummaryCard]                 │ |
| │ Title: "기본 정보"              │ |
| │ - 이름: {name}                 │ |
| │ - 현재 체중: {weight} kg       │ |
| │ - 목표 체중: {target} kg       │ |
| │ - 감량 목표: {diff} kg         │ |
| │                               │ |
| │ [SummaryCard]                 │ |
| │ Title: "투여 계획"              │ |
| │ - 약물명: {med}                │ |
| │ - 시작일: {date}               │ |
| │ - 주기: {cycle}일              │ |
| │ - 초기 용량: {dose} mg         │ |
| │                               │ |
| │ [Loading / Error / Confirm]   │ |
| │ - Show spinner while saving   │ |
| │ - Show error + retry if fail  │ |
| │ - Show confirm button         │ |
| │                               │ |
| │ [GabiumButton Primary]        │ |
| │ "확인" (confirms & saves)     │ |
| └──────────────────────────────┘ |
|                                  |
+----------------------------------+
```

## Approval Required

- [ ] User approves improvement direction
- [ ] All Design System tokens available (Gabium v1.0)
- [ ] Component dependencies acknowledged (GabiumTextField, GabiumButton, AuthHeroSection)
- [ ] Preserved elements confirmed
- [ ] Ready to proceed to Phase 2B implementation
