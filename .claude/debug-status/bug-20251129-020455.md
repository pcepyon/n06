---
status: VERIFIED
timestamp: 2025-11-29T02:04:55+09:00
bug_id: bug-20251129-020455
verified_by: error-verifier
severity: High
---

# ë²„ê·¸ ê²€ì¦ ë¦¬í¬íŠ¸

## ë²„ê·¸ ID
bug-20251129-020455

## ìƒíƒœ
VERIFIED âœ…

## ë²„ê·¸ í˜„ìƒ
ì˜¨ë³´ë”© ë§ˆì§€ë§‰ í˜ì´ì§€(14ë‹¨ê³„: CommitmentScreen)ì—ì„œ "ì—¬ì • ì‹œì‘í•˜ê¸°" ìŠ¤ì™€ì´í”„ë¥¼ ì™„ë£Œí•˜ë©´ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³  í˜„ì¬ ì˜¨ë³´ë”© í™”ë©´ì— ë¨¸ë¬¼ëŸ¬ ìˆìŠµë‹ˆë‹¤.

## ì¬í˜„ ê²½ë¡œ
1. ì•± ì‹¤í–‰ í›„ ì˜¨ë³´ë”© í”Œë¡œìš° ì‹œì‘
2. 14ë‹¨ê³„ê¹Œì§€ ëª¨ë“  ì–‘ì‹ ì‘ì„± ì™„ë£Œ
3. ë§ˆì§€ë§‰ CommitmentScreenì—ì„œ "ì—¬ì • ì‹œì‘í•˜ê¸° ğŸš€" ìŠ¤ì™€ì´í”„ ìŠ¬ë¼ì´ë”ë¥¼ ëê¹Œì§€ ë°€ê¸°
4. Confetti ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ í›„ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
5. ë‹¤ì´ì–¼ë¡œê·¸ì—ì„œ "ê¸°ë¡í•˜ëŸ¬ ê°€ê¸°" ë²„íŠ¼ í´ë¦­
6. **ì˜ˆìƒ**: í™ˆ í™”ë©´ ë˜ëŠ” ì²´ì¤‘ ê¸°ë¡ í™”ë©´ìœ¼ë¡œ ì´ë™
7. **ì‹¤ì œ**: ì˜¨ë³´ë”© í™”ë©´ì— ê·¸ëŒ€ë¡œ ë¨¸ë¬¼ëŸ¬ ìˆìŒ

## ìˆ˜ì§‘ëœ ì¦ê±°

### ê´€ë ¨ íŒŒì¼
- `/Users/pro16/Desktop/project/n06/lib/features/onboarding/presentation/screens/onboarding_screen.dart:252-269` (ë„¤ë¹„ê²Œì´ì…˜ ëˆ„ë½)
- `/Users/pro16/Desktop/project/n06/lib/features/onboarding/presentation/widgets/preparation/commitment_screen.dart:48-108` (ì½œë°± í˜¸ì¶œ)
- `/Users/pro16/Desktop/project/n06/lib/core/routing/app_router.dart:113-120` (ë¼ìš°í„° ì„¤ì •)

### ë¬¸ì œ ì½”ë“œ ìŠ¤ë‹ˆí«

#### 1. OnboardingScreen ë¼ìš°í„° ì„¤ì • (app_router.dart:113-120)
```dart
/// Onboarding (F000) - without Bottom Nav
GoRoute(
  path: '/onboarding',
  name: 'onboarding',
  builder: (context, state) {
    final userId = state.extra as String?;
    return OnboardingScreen(userId: userId);
    // âŒ ë¬¸ì œ: onComplete ì½œë°±ì´ ì „ë‹¬ë˜ì§€ ì•ŠìŒ!
  },
),
```

#### 2. OnboardingScreen ìƒì„±ì (onboarding_screen.dart:32-36)
```dart
class OnboardingScreen extends StatefulWidget {
  final String? userId;
  final VoidCallback? onComplete;  // âœ… Optional ì½œë°±
  
  const OnboardingScreen({super.key, this.userId, this.onComplete});
  // ...
}
```

#### 3. OnboardingScreenì˜ _completeOnboarding ë©”ì„œë“œ (onboarding_screen.dart:252-269)
```dart
/// ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬
Future<void> _completeOnboarding() async {
  // education_completed í”Œë˜ê·¸ ì €ì¥
  final prefs = await SharedPreferences.getInstance();
  await prefs.setBool('education_completed', true);

  // initial_food_noise_level ì €ì¥ (ì„ íƒ)
  if (_initialFoodNoiseLevel != null) {
    await prefs.setInt('initial_food_noise_level', _initialFoodNoiseLevel!);
  }

  // âŒ ë¬¸ì œ: onCompleteê°€ nullì´ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ!
  if (mounted) {
    if (widget.onComplete != null) {
      widget.onComplete!();  // nullì´ë¯€ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
    }
    // âŒ ë„¤ë¹„ê²Œì´ì…˜ ë¡œì§ì´ ì—†ìŒ
  }
}
```

#### 4. CommitmentScreenì˜ ì™„ë£Œ ì²˜ë¦¬ (commitment_screen.dart:84-88)
```dart
TextButton(
  onPressed: () {
    HapticFeedback.lightImpact();
    Navigator.pop(context);  // ë‹¤ì´ì–¼ë¡œê·¸ë§Œ ë‹«ìŒ
    widget.onComplete();     // âœ… ì½œë°± í˜¸ì¶œ (í•˜ì§€ë§Œ _completeOnboardingì—ì„œ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨)
  },
  // ...
)
```

### ê´€ì°° ì‚¬í•­

1. **ë¼ìš°í„°ì—ì„œ ì½œë°± ë¯¸ì „ë‹¬**: `app_router.dart`ì˜ OnboardingScreen ìƒì„± ì‹œ `onComplete` ì½œë°±ì„ ì „ë‹¬í•˜ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.
   ```dart
   return OnboardingScreen(userId: userId);
   // onComplete: () { context.go('/home'); } ê°€ ë¹ ì§!
   ```

2. **ë„¤ë¹„ê²Œì´ì…˜ ë¡œì§ ë¶€ì¬**: `_completeOnboarding` ë©”ì„œë“œëŠ” SharedPreferencesì— í”Œë˜ê·¸ë§Œ ì €ì¥í•˜ê³ , ì‹¤ì œ í™”ë©´ ì „í™˜ ë¡œì§ì´ ì—†ìŠµë‹ˆë‹¤.

3. **null ì½œë°± ì²˜ë¦¬ ë¶€ì¡±**: `onComplete`ê°€ nullì¼ ë•Œ ëŒ€ì²´ ë™ì‘(fallback)ì´ ì—†ì–´, ì‚¬ìš©ìê°€ ì˜¨ë³´ë”© í™”ë©´ì— ê°‡íˆê²Œ ë©ë‹ˆë‹¤.

4. **í…ŒìŠ¤íŠ¸ ëˆ„ë½ ê°€ëŠ¥ì„±**: ì´ ë²„ê·¸ëŠ” í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œ ë°œê²¬ë˜ì—ˆì–´ì•¼ í•˜ì§€ë§Œ, ì˜¨ë³´ë”© ì™„ë£Œ í›„ ë„¤ë¹„ê²Œì´ì…˜ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ê°€ ì—†ì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

## ë²„ê·¸ ì›ì¸ ë¶„ì„

### ê·¼ë³¸ ì›ì¸ (Root Cause)
**app_router.dartì—ì„œ OnboardingScreen ìƒì„± ì‹œ `onComplete` ì½œë°±ì„ ì „ë‹¬í•˜ì§€ ì•ŠìŒ**

```dart
// í˜„ì¬ (ë²„ê·¸ ìˆìŒ)
builder: (context, state) {
  final userId = state.extra as String?;
  return OnboardingScreen(userId: userId);
}

// ìˆ˜ì • í•„ìš”
builder: (context, state) {
  final userId = state.extra as String?;
  return OnboardingScreen(
    userId: userId,
    onComplete: () => context.go('/home'),  // í™ˆìœ¼ë¡œ ì´ë™
  );
}
```

### ê¸°ì—¬ ì›ì¸ (Contributing Factors)

1. **ì„¤ê³„ ë¶ˆì¼ì¹˜**: OnboardingScreenì€ `onComplete` ì½œë°±ì— ì˜ì¡´í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆì§€ë§Œ, ë¼ìš°í„°ì—ì„œëŠ” ì´ë¥¼ ì „ë‹¬í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

2. **Fallback ë¶€ì¬**: `onComplete`ê°€ nullì¼ ë•Œ ê¸°ë³¸ ë™ì‘(ì˜ˆ: context.go('/home'))ì´ ì—†ì–´, ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.

3. **ë ˆì´ì–´ ì±…ì„ í˜¼ë€**: CLAUDE.mdì˜ ë ˆì´ì–´ ê·œì¹™ì— ë”°ë¥´ë©´ Presentation Layerê°€ ë„¤ë¹„ê²Œì´ì…˜ì„ ë‹´ë‹¹í•´ì•¼ í•˜ëŠ”ë°, í˜„ì¬ëŠ” ì½œë°±ìœ¼ë¡œ ì±…ì„ì„ ì™¸ë¶€ì— ìœ„ì„í•˜ê³  ìˆì–´ ë¶ˆëª…í™•í•©ë‹ˆë‹¤.

## ì˜í–¥ë„ í‰ê°€

### ì‹¬ê°ë„: High âš ï¸
- ì‚¬ìš©ìê°€ ì˜¨ë³´ë”©ì„ ì™„ë£Œí•´ë„ ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- ì‹ ê·œ ì‚¬ìš©ìì˜ ì²« ê²½í—˜(First-Time User Experience) ì™„ì „ ì°¨ë‹¨
- ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ(ì‚¬ìš©ì ì˜¨ë³´ë”©) ë‹¬ì„± ë¶ˆê°€

### ì˜í–¥ ë²”ìœ„
- **ì˜í–¥ ë°›ëŠ” ì»´í¬ë„ŒíŠ¸**:
  - OnboardingScreen (ì „ì²´)
  - CommitmentScreen (ë§ˆì§€ë§‰ ë‹¨ê³„)
  - app_router.dart (ì˜¨ë³´ë”© ë¼ìš°íŠ¸)
  
- **ì˜í–¥ ë°›ëŠ” ì‚¬ìš©ì**:
  - ëª¨ë“  ì‹ ê·œ ì‚¬ìš©ì (100%)
  - ì¬ì˜¨ë³´ë”© ì‹œë„ ì‚¬ìš©ì

### ë°œìƒ ë¹ˆë„
- **í•­ìƒ ë°œìƒ** (100% ì¬í˜„ìœ¨)
- ì¡°ê±´: ì˜¨ë³´ë”©ì„ ëê¹Œì§€ ì™„ë£Œí•˜ëŠ” ëª¨ë“  ê²½ìš°

## ê¶Œì¥ í•´ê²° ë°©ì•ˆ

### Option A: ë¼ìš°í„°ì—ì„œ ì½œë°± ì „ë‹¬ (ê¶Œì¥) â­
**íŒŒì¼**: `/Users/pro16/Desktop/project/n06/lib/core/routing/app_router.dart`

```dart
GoRoute(
  path: '/onboarding',
  name: 'onboarding',
  builder: (context, state) {
    final userId = state.extra as String?;
    return OnboardingScreen(
      userId: userId,
      onComplete: () {
        // ì˜¨ë³´ë”© ì™„ë£Œ í›„ í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
        context.go('/home');
      },
    );
  },
),
```

**ì¥ì **:
- ìµœì†Œ ë³€ê²½ìœ¼ë¡œ ì¦‰ì‹œ í•´ê²°
- ë ˆì´ì–´ ì±…ì„ ëª…í™• (Presentationì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ì²˜ë¦¬)
- ê¸°ì¡´ ì„¤ê³„ íŒ¨í„´ ìœ ì§€

**ë‹¨ì **:
- ì½œë°± íŒ¨í„´ ìœ ì§€ (í–¥í›„ ë³µì¡í•œ ë¡œì§ ì²˜ë¦¬ ì–´ë ¤ì›€)

---

### Option B: OnboardingScreenì— Fallback ë¡œì§ ì¶”ê°€ (ë°©ì–´ì )
**íŒŒì¼**: `/Users/pro16/Desktop/project/n06/lib/features/onboarding/presentation/screens/onboarding_screen.dart`

```dart
Future<void> _completeOnboarding() async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setBool('education_completed', true);

  if (_initialFoodNoiseLevel != null) {
    await prefs.setInt('initial_food_noise_level', _initialFoodNoiseLevel!);
  }

  if (mounted) {
    if (widget.onComplete != null) {
      widget.onComplete!();
    } else {
      // Fallback: ì½œë°±ì´ ì—†ìœ¼ë©´ ì§ì ‘ ë„¤ë¹„ê²Œì´ì…˜
      if (context.mounted) {
        context.go('/home');
      }
    }
  }
}
```

**ì¥ì **:
- ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°
- ì½œë°±ì´ ì—†ì–´ë„ ë™ì‘ ë³´ì¥

**ë‹¨ì **:
- import 'package:go_router/go_router.dart' í•„ìš”
- BuildContext ì‚¬ìš© (ìœ„ì ¯ ìƒëª…ì£¼ê¸° ì£¼ì˜)

---

### Option C (ë¹„ê¶Œì¥): Application Layerì—ì„œ ìƒíƒœ ê´€ë¦¬
- OnboardingNotifierì—ì„œ ì™„ë£Œ ìƒíƒœ ê´€ë¦¬
- GoRouter redirectë¡œ ìë™ ë¼ìš°íŒ…

**ë¹„ê¶Œì¥ ì´ìœ **:
- CLAUDE.md ìœ„ë°˜: Application Layerì—ì„œ context.go() ì‚¬ìš© ë¶ˆê°€
- ê³¼ë„í•œ ì„¤ê³„ ë³€ê²½

---

## ìˆ˜ì • ìš°ì„ ìˆœìœ„

1. **ì¦‰ì‹œ ìˆ˜ì • (Critical)**: Option A ì ìš©í•˜ì—¬ ë²„ê·¸ í•´ê²°
2. **ë°©ì–´ ë¡œì§ ì¶”ê°€ (High)**: Option Bì˜ Fallback ë¡œì§ ì¶”ê°€
3. **í…ŒìŠ¤íŠ¸ ë³´ê°• (Medium)**: ì˜¨ë³´ë”© ì™„ë£Œ í›„ ë„¤ë¹„ê²Œì´ì…˜ ê²€ì¦ í…ŒìŠ¤íŠ¸ ì¶”ê°€

## Quality Gate 1 ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ë²„ê·¸ ì¬í˜„ ê²½ë¡œ ì‹ë³„ ì™„ë£Œ
- [x] ì¦ê±° ìˆ˜ì§‘ ì™„ë£Œ (ì½”ë“œ + ë¼ìš°í„° ë¶„ì„)
- [x] ê´€ë ¨ íŒŒì¼ ì‹ë³„ ì™„ë£Œ
- [x] ê·¼ë³¸ ì›ì¸ íŠ¹ì • ì™„ë£Œ
- [x] ì˜í–¥ë„ í‰ê°€ ì™„ë£Œ
- [x] í•´ê²° ë°©ì•ˆ ì œì‹œ ì™„ë£Œ
- [x] í•œê¸€ ë¬¸ì„œ ì‘ì„± ì™„ë£Œ

## ë‹¤ìŒ ë‹¨ê³„
root-cause-analyzer ì—ì´ì „íŠ¸ë¥¼ í˜¸ì¶œí•˜ì—¬:
1. âœ… GoRouter ì„¤ì • í™•ì¸ ì™„ë£Œ
2. âœ… OnboardingScreen í˜¸ì¶œ ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ
3. âœ… ê·¼ë³¸ ì›ì¸ íŠ¹ì • ì™„ë£Œ
4. ìˆ˜ì • PR ìƒì„± ì¤€ë¹„

## ì°¸ê³  ë¬¸ì„œ
- `/Users/pro16/Desktop/project/n06/CLAUDE.md` - Layer Responsibility ê·œì¹™
- `/Users/pro16/Desktop/project/n06/docs/017-education-onboarding/spec.md` - ì˜¨ë³´ë”© ëª…ì„¸
- `/Users/pro16/Desktop/project/n06/docs/009/ROUTER_INTEGRATION_REPORT.md` - ë¼ìš°í„° í†µí•© ë¦¬í¬íŠ¸
